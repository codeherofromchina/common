<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="com.erui.report.dao.SalesDataStatisticsMapper">

    <!--查询代理供应商按照事业部纬度、时间条件统计总数-->
    <select id="agencySupplierOrgStatisticsData" parameterType="java.util.Map" resultType="java.util.Map">
       SELECT
            t2.`name`, COUNT(1) AS total
        FROM
            erui_supplier.supplier t1
                LEFT JOIN
            erui_sys.org t2 ON t1.org_id = t2.id
        WHERE
            t1.`status` = 'APPROVING'
                AND t1.supplier_type = 'AGENCY'
                AND t1.created_at BETWEEN #{startTime} AND #{endTime}
        GROUP BY t2.`name` ORDER BY 2
        <if test="sort != 1" >
          DESC
        </if>
    </select>

    <!--查询代理供应商按照国家纬度、时间条件统计总数-->
    <select id="agencySupplierCountryStatisticsData" parameterType="java.util.Map" resultType="java.util.Map">
        SELECT
        t2.`name`, COUNT(1) AS total
        FROM
        erui_supplier.supplier t1
        LEFT JOIN
        erui_dict.country t2 ON t2.lang = 'zh' AND t1.country_bn = t2.bn
        WHERE
        t1.`status` = 'APPROVING'
        AND t1.supplier_type = 'AGENCY'
        AND t1.created_at BETWEEN #{startTime} AND #{endTime}
        GROUP BY t2.`name`
        ORDER BY 2
        <if test="sort != 1" >
            DESC
        </if>
    </select>
</mapper>